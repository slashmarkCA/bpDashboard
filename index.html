<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Pressure - History and Analysis</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@sgratzl/chartjs-chart-boxplot@4.4.1/build/index.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix"></script>
    <!-- REQUIRED for time scale change on labels TODO: May not need this...aborted an x-axis label density redesign -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
    
    <!-- for my imported archivo font - preconnect because I'm seeing HTTP2 transport failures -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>

<body>
    <header class="header">
        <!-- look into bringing in some different fonts at fonts.google.com. -->
        <!-- What is BEM notation?  It's the __ he used -->
        <div class="header__content">
                <h1>Blood Pressure <span>history and analysis</span></h1>
            <nav>
                <ul class="nav__list">
                    <li><a href="#" class="date-pill active" data-filter="last7days">7 Days</a></li>
                    <li><a href="#" class="date-pill" data-filter="last14days">14 Days</a></li>
                    <li><a href="#" class="date-pill" data-filter="last30days">30 Days</a></li>
                    <li><a href="#" class="date-pill" data-filter="all">All</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <noscript>
    <div class="noscript-warning">
        This dashboard requires JavaScript to function properly.
        Please enable JavaScript and reload the page.
    </div>
    </noscript>

    <main class="container">
        <section id="5colTopSummary">
            <div class="five-col">
                <div class="measureCardBadges" id="summary-counts-card">
                    <div class="badge-item badge-readings">
                        <span class="badge-number" id="total-readings">--</span>
                        <span class="badge-label">READINGS</span>
                    </div>
                    <div class="badge-item badge-days">
                        <span class="badge-number" id="total-days">--</span>
                        <span class="badge-label">DAYS</span>
                    </div>
                </div>
                <div class="measureCard" id="sys-card">
                    <span id="sys-warning" class="warning-badge">⚠️</span>
                    <div class="measureName">SYS<small>TOLIC</small></div>
                    <div class="measureHiLo">
                        High: <span id="sys-high">--</span><br>
                        Low: <span id="sys-low">--</span>
                    </div>
                    <div class="measureAvg">
                        <small>Average</small> <span id="sys-avg">--</span>
                    </div>
                </div>
                <div class="measureCard" id="dia-card">
                    <span id="dia-warning" class="warning-badge">⚠️</span>
                    <div class="measureName">DIA<small>STOLIC</small></div>
                    <div class="measureHiLo">
                        High: <span id="dia-high">--</span><br>
                        Low: <span id="dia-low">--</span>
                    </div>
                    <div class="measureAvg"><small>Average</small> <span id="dia-avg">--</span></div>
                </div>
                <div class="measureCard" id="pulse-card">
                    <span id="pulse-warning" class="warning-badge">⚠️</span>
                    <div class="measureName">BPM<small>PULSE</small></div>
                    <div class="measureHiLo">
                        High: <span id="pulse-high">--</span><br>
                        Low: <span id="pulse-low">--</span>
                    </div>
                    <div class="measureAvg"><small>Average</small> <span id="pulse-avg">--</span></div>
                </div>
                <div class="measureCard" id="PulsePressure-card">
                    <span id="pp-warning" class="warning-badge">⚠️</span>
                    <div class="measureName">PULSE<small>PRESSURE</small></div>
                    <div class="measureHiLo">
                        High: <span id="pp-high">--</span><br>
                        Low: <span id="pp-low">--</span>
                    </div>
                    <div class="measureAvg"><small>Average</small> <span id="pp-avg">--</span></div>
                </div>
            </div>
        </section>

		<section id="3colTopSummary">
            <div class="three-col">
                <div class="nobgCard">
<!--                <h3>
                        <span class="info-icon" onclick="openDocDrawer('readingCategorySummary')">ℹ️</span>
                        Daily Readings
                    </h3> -->
                    <div class="heatmap-wrapper">
                        <div class="heatmap-scroll-area">
                            <canvas id="bpHeatmap"></canvas>
                        </div>
                    </div>            
                </div>

                <div class="nobgCard">
<!--                <h3>
                        <span class="info-icon" onclick="openDocDrawer('readingCategorySummary')">ℹ️</span>
                        Reading Categories Summary
                    </h3> -->
                    <div id="readingCategoriesSummaryCard"></div>
                </div>
        
                <div class="nobgCard">
<!--                <h3>
                        <span class="info-icon" onclick="openDocDrawer('normalNotNormalDonut')">ℹ️</span>
                        Normal Vs Risky
                    </h3>-->
                    <div class="donut-wrapper">
                        <canvas id="normalDonutChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="ReadingCategories">
            <div class="two-col">
                <div class="card">
                    <h3>
                        <span class="info-icon" onclick="openDocDrawer('readingCategoriesLineChart')">ℹ️</span>
                        Reading Categories - Individual Readings Over Time
                    </h3>
                    <div style="position: relative; width: 100%; height: 350px;">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

               <div class="card" style="overflow: visible;">
                   <h3>
                    <span class="info-icon" onclick="openDocDrawer('readingCategoriesScatterDistribution')">ℹ️</span>
                    Reading Categories - Distribution Pattern
                    </h3>
                   <div style="position: relative;">
                       <canvas id="bpScatterChart" style="aspect-ratio: 4 / 4.5;"></canvas>
                   </div>
               </div>
            </div>
        </section>

        <section id="Pluse">
            <div class="two-col">
                <div class="card">
                    <h3>
                        <span class="info-icon" onclick="openDocDrawer('BPMLineChart')">ℹ️</span>
                        Pulse (Beats per Minute)
                    </h3>
                    <div style="position: relative; aspect-ratio: 16 / 6;">
                        <canvas id="pulseLineChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>
                        <span class="info-icon" onclick="openDocDrawer('bpmHistogram')">ℹ️</span>
                        Pulse Distribution (Histogram)
                    </h3>
                    <div style="position: relative; aspect-ratio: 4/3;">
                        <canvas id="pulseHistogram"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="PulsePressure">
            <div class="two-col">
                <div class="card">
                    <h3>
                        <span class="info-icon" onclick="openDocDrawer('ppLineChart')">ℹ️</span>
                        Pulse Pressure
                    </h3>
                    <div style="position: relative; width: 100%; aspect-ratio: 16 / 6;">
                        <canvas id="pulsePressureLineChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>
                        <span class="info-icon" onclick="openDocDrawer('pulsePressureHistogram')">ℹ️</span>
                        Pulse Pressure Distribution (Histogram)
                    </h3>
                    <div style="position: relative; width: 100%; aspect-ratio: 4/3;">
                        <canvas id="pulsePressureHistogram"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="SysAndDia">
            <div class="two-col">
                <div class="card">
                    <h3>
                        <span class="info-icon" onclick="openDocDrawer('sysAndDiaLineChart')">ℹ️</span>
                        Systolic and Diastolic Raw Readings
                    </h3>
                    <div style="aspect-ratio: 16 / 6; position: relative;">
                        <canvas id="sysAndDiaChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>
                        <span class="info-icon" onclick="openDocDrawer('sysAndDiaBoxAndWhisker')">ℹ️</span>
                        Sys & Dia Volatility (Box & Whisker)</h3>
                    <div style="width:100%; aspect-ratio:4/3;">
                        <canvas id="boxWhiskerChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="map7DayLineChart">
            <div class="card">
                <h3>
                    <span class="info-icon" onclick="openDocDrawer('7DayMAP')">ℹ️</span>
                    7 Day Rolling Average - Mean Arterial Pressure</h3>
                <div style="position: relative; width: 100%; aspect-ratio: 16 / 4;">
                    <canvas id="map7DayChart"></canvas>
                </div>
            </div>
        </section>

        <section id="section-combined-rolling">
            <div class="card">
                <div class="rolling-controls-container">
                    <h3 style="margin: 0;">
                        <span class="info-icon" onclick="openDocDrawer('sysAndDiaRollingAvg')">ℹ️</span>
                        Combined 7-Day Rolling Average (Systolic + Diastolic)</h3>
                    <div class="rolling-controls">
                        <div class="control-label">Standard Deviation Band:</div>
                        <div class="radio-group">
                            <label class="control-option">
                                <input type="radio" name="combinedBandMode" value="systolic" onchange="toggleCombinedStdDevBand('systolic')" />
                                <span class="sys-text">Sys</span>
                            </label>
                            <label class="control-option">
                                <input type="radio" name="combinedBandMode" value="diastolic" onchange="toggleCombinedStdDevBand('diastolic')" />
                                <span class="dia-text">Dia</span>
                            </label>
                            <label class="control-option">
                                <input type="radio" name="combinedBandMode" value="none" checked onchange="toggleCombinedStdDevBand('none')" />
                                <span>No Band</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div style="height: 400px; position: relative;">
                    <canvas id="combinedRollingChart"></canvas>
                </div>
            </div>
        </section>

        <section id="rawData">
            <div class="card">
                <h3>
                    <span class="info-icon" onclick="openDocDrawer('rawDataGridview')">ℹ️</span>
                    Raw Data</h3>
                    <div id="bpRawDataTable"></div>
            </div>
        </section>
    </main>

    <footer>
        <p><a href="https://slashmarkca.github.io/bpDashboard/">Blood Pressure Dashboard</a> | <a href="https://github.com/slashmarkCA/bpDashboard">github repo</a> | <a href="#">tableau</a> | <a href="https://forms.gle/N4FZoaGy3GxCN75P6">Contact Me</a></p>
    </footer>

    <div id="infoDrawer" class="info-drawer">
        <div class="drawer-header">
            <h2 id="drawerTitle">Documentation</h2>
            <button id="closeDrawer" class="close-btn">&times;</button>
        </div>
        <div id="drawerContent" class="drawer-content">
            </div>
    </div>
    <div id="drawerOverlay" class="drawer-overlay"></div>


    <!-- Laws of Aggregation for data-aggregation="..." and data-logic  -->
    <!-- reading-simple: Every measurement counts as 1 -->
    <!-- day-mean-simple: Every day counts as 1 (after collapsing its readings) -->
    <!-- raw: No aggregation, just show the dots -->

    <!-- Content inside the sliding drawer "about this chart" -->
    <script type="module" src="utils/errorHandling.js" defer></script>
    <script src="src/docLibrary.js" defer></script>

    <!-- Core data & utilities -->
    <!-- Core data loader (fetches from GitHub) -->
    <!-- Cannot be a module....The loader needs to run in global scope to set window.BP_DATA-->
    <script src="utils/bp_data_loader.js" defer></script>
    <script type="module" src="utils/bp_data_normalized.js" defer></script>
    <script type="module" src="utils/bp_utils.js" defer></script>
    <script type="module" src="utils/bp_filters.js" data-logic="volume-window" defer></script>
    <script src="utils/bp_docs.js" defer></script> <!-- sliding drawer constructor -->

    <!-- Chart dispatcher -->
    <script type="module" src="utils/bp_charts.js" defer></script>

    <!-- Chart modules -->
	<script type="module" src="src/bp_charts_line.js" data-aggregation="raw" defer></script>
    <script type="module" src="src/bp_pulse_line.js" data-aggregation="raw" defer></script>
    <script type="module" src="src/bp_charts_scatter.js" data-aggregation="raw" defer></script>
    <script type="module" src="src/bp_pulse_histogram.js" data-aggregation="raw" defer></script>
    <script type="module" src="src/bp_pulsePressure_histogram.js" data-aggregation="raw" defer></script>
    <script type="module" src="src/bp_SysDia_volatilityBoxAndWhisker.js" data-aggregation="raw" defer></script>
    <script type="module" src="src/bp_pulsePressure_line.js" data-aggregation="raw" defer></script>
    <script type="module" src="src/bp_categoryOverTime.js" data-aggregation="day-mean-simple" defer></script>
    <script type="module" src="src/bp_charts_combined_rolling.js" data-aggregation="day-mean-simple" defer></script>
    <script type="module" src="src/bp_7dayAvg_combined_map_line.js" data-aggregation="day-mean-simple" defer></script>
    <script type="module" src="src/bp_heatmap.js" data-aggregation="raw" defer></script>

    <!-- Summary cards -->
    <script type="module" src="src/ReadingsInDaysCard.js" data-aggregation="reading-simple" defer></script>
    <script type="module" src="src/readingCategoriesSummaryCard.js" data-aggregation="reading-simple" defer></script>
    <script type="module" src="src/bp_5colAggregateSummary_cards.js" data-aggregation="reading-simple" defer></script>
    <script type="module" src="src/filteredNormalDonutCard.js" data-aggregation="reading-simple" defer></script>
    <script type="module" src="src/bp_rawDataTabularView.js" data-aggregation="raw" defer></script>

</body>
</html>